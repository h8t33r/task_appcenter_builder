# PowerShell Builder for Microsoft AppCenter
Version: 0.2

Скрипт запускает процесс сборки приложения в Microsoft Application Center.

Работоспособность проверена на Windows 10 / PowerShell 5.1
https://openapi.appcenter.ms/#/

## Usage
1. Укажите 40-символьный токен. Токен генерируется в настройках пользователя AppCenter
```
$apiTokenFA = "957fb01333c30c88f493f5083641802470ae1105"
```
2. Укажите название приложения
```
$applicationName = "Example-Application"
```
3. Запустите скрипт

## Принцип действия

### До Try { } блока:

#### 1. Инициализируем переменные
$apiTokenFA - токен с полным доступом

$apiTokenRO - токен с доступом только для чтения

$applicationName - имя приложения

#### 2. Функции

##### Create-Folders { }
Проверяем доступность директорий логов и отчетов. Если отсутствуют - создаем.

##### Get-API-Response { }
1. Указываем appcenter root url
2. Указываем стандартные заголовки
3. Указываем использовать SSL
4. Смотрим, есть ли тело и делаем POST/GET запрос
5. Если HTTP 200, логируем и возвращаем JSON. Иначе пишем в лог ошибку доступа.

##### Create-Report { }
1. Заново смотрим список бранчей
2. Формируем репорт

### Внутри Try { } блока
1. Получаем данные пользователя, чей токен был указан.
2. Получаем список веток репозитория указанного в начале приложения пользователя.
3. В цикле проходим по всем веткам, вычленяем их имя и последний 40-символьный sourceVersion коммита.
4. В этом же цикле приложения встают в очередь внутри AppCenter на сборку.
5. Ждем, пока освободится очередь и запускаем оставшиеся бранчи на сборку.
6. Пишем в лог

### Внутри Catch { } блока
Отлавливаем исключения и пишем в лог.

### Внутри Finally { } блока
Обнуляем все, что плохо лежит